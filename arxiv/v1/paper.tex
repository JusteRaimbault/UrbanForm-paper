\documentclass[letterpaper]{article}

\usepackage{natbib,alifeconf}  %% The order is important
\usepackage{amsmath}
\usepackage{bbm}
\newcommand{\norm}[1]{\left\Vert #1\right\Vert}
\usepackage{url}

\usepackage{subcaption}
%\graphicspath{{figures/}}
% *****************
%  Requirements:
% *****************
%
% - All pages sized consistently at 8.5 x 11 inches (US letter size).
% - PDF length <= 8 pages for full papers, <=2 pages for extended
%    abstracts.
% - Abstract length <= 250 words.
% - No visible crop marks.
% - Images at no greater than 300 dpi, scaled at 100%.
% - Embedded open type fonts only.
% - All layers flattened.
% - No attachments.
% - All desired links active in the files.

% Note that the PDF file must not exceed 5 MB if it is to be indexed
% by Google Scholar. Additional information about Google Scholar
% can be found here:
% http://www.google.com/intl/en/scholar/inclusion.html.


% If your system does not generate letter format documents by default,
% you can use the following workflow:
% latex example
% bibtex example
% latex example ; latex example
% dvips -o example.ps -t letterSize example.dvi
% ps2pdf example.ps example.pdf


% For pdflatex users:
% The alifeconf style file loads the "graphicx" package, and
% this may lead some users of pdflatex to experience problems.
% These can be fixed by editing the alifeconf.sty file to specify:
% \usepackage[pdftex]{graphicx}
%   instead of
% \usepackage{graphicx}.
% The PDF output generated by pdflatex should match the required
% specifications and obviously the dvips and ps2pdf steps become
% unnecessary.


% Note:  Some laser printers have a serious problem printing TeX
% output. The use of ps type I fonts should avoid this problem.


\title{Generating urban morphologies at large scales}
\author{Juste Raimbault$^{1,2,3,*}$ \and Julien Perret$^{1,4}$ \\
\mbox{}\\
$^1$UPS CNRS 3611 ISC-PIF\\
$^2$CASA, UCL\\
$^3$UMR CNRS 8504 G{\'e}ographie-cit{\'e}s\\
$^4$Univ. Paris-Est, LaSTIG STRUDEL, IGN, ENSG\\
\medskip
* juste.raimbault@polytechnique.edu} % email of corresponding author

% For several authors from the same institution use the same number to
% refer to one address.
%
% If the names do not fit well on one line use
%         Author 1, Author 2 ... \\ {\Large\bf Author n} ...\\ ...
%
% If the title and author information do not fit in the area
% allocated, place \setlength\titlebox{<new height>} after the
% \documentclass line where <new height> is 2.25in



\begin{document}
\maketitle

\begin{abstract}
% Abstract length should not exceed 250 words
  At large scales, typologies of urban form and corresponding generating processes remain an open question with important implications regarding urban planning policies and sustainability.
  We propose in this paper to generate urban configurations at large scales, typically of districts, with morphogenesis models, and compare these to real configurations according to morphological indicators.
  Real values are computed on a large sample of districts taken in European urban areas.
  We calibrate each model and show their complementarity to approach the variety of real urban configurations, paving the way to multi-model approaches of urban morphogenesis.
\end{abstract}


%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}


The study of forms of the built environment, and more precisely of the urban environment, has been the subject of different disciplines such as architecture, urban planning, or geography, with different approaches corresponding to various scales and processes \citep{moudon1997urban,gauthier2006mapping,kropf2009aspects}.
Establishing typologies of urban morphologies, and understanding their link with underlying urban growth processes, is nowadays a crucial issue for sustainability as a large majority of the world population live in cities and energy consumption is closely related to urban form through e.g. mobility patterns and automobile dependance \citep{newman2000sustainable}.


Although there is neither a unified definition of urban form, nor unified generative models and quantitative indicators to measure it, several approaches are close to the spirit of artificial life and generative social science~\citep{bonabeau1997classical,epstein1999agent}.
Procedural modeling \citep{watson2008procedural} aims at generating realistic cities, but is mostly focused on the visual impression given and does not consider realistic generative processes.
It is furthermore developed largely at larger scales than the one of the district \citep{Parish:2001:PMC:383259.383292}. \cite{merrell2010computer} generates in that context plans for interior of buildings, whereas \cite{cruz2017generation} uses a cellular automaton model for building morphogenesis.
Approaches linked to urban planning have focused on the spatial distribution of land-use, at multiple resolutions \citep{liu2017future}, and proposed cellular automata models for urban sprawl, generally at the scale of the metropolitan area \citep{herold2003spatiotemporal}. For example, \cite{horner2007multi} proposes a link between urban form based on land-use and commuting.


Urban form can furthermore be characterized considering different components of the urban system, such as building themselves as in several examples given before, but also for example transportation networks such as road networks \citep{ye2014quantitative}. To what extent these layers are complementary remains an open question, despite a few investigations coupling the two such as \cite{raimbault2018urban} suggesting indeed complementary dimensions. Regarding the geometrical properties of building layouts at the scale of a district, that we denote to simplify as urban form at a large scale, systematic characterizations and generative models remains rather rare. \cite{achibet2014model} for example describes a model of co-evolution of building layout and road network.



This paper proposes a first step towards a systematic understanding of generative models of the urban form, at a large scale.
The approach taken here is similar to the one taken by \cite{raimbault2018calibration}, which computes urban form indicators at a mesoscopic scale (metropolitan area) and calibrates a reaction-diffusion morphogenesis model.
We consider real urban configurations at the scale of the district (fixed spatial window of 500m), compute their morphological characteristics, and use these measures to calibrate different generative models of urban layouts at the same scale.
Our contribution is twofold: (i) we synthesize a set of indicators relevant at this scale, and compute them on a large sample of real urban configurations in European urban areas; (ii) we provide three different generative models complementary in the type of processes taken into account, and calibrate these models on the real morphological measures. We show therein the complementarity of the different processes to produce the variety of real urban forms considered.
This is to the best of our knowledge the first time several generative models at this scale are systematically compared on a large number of real configurations through quantitative measures.

The rest of this article is structured as follows.
First, we present the methods used in our work, including the measures allowing the comparison of urban forms, the proposed generative models and the method used to retrieve real urban configurations.
The results of the proposed approach are then explained together with the tools used in the calibration of the models.
Finally, the results are discussed.

%%%%%%%%%%%%%%%%%%%%%
\section{Methods} \label{sec:methods}

The approach taken requires both a robust way to quantify urban forms, through indicators that can be understood as features in the sense of machine learning, and generative models.

\subsection{Quantifying urban forms}

The quantification of urban form is in itself covered by a vast literature.
Recent work have proposed to apply deep learning techniques directly on vector data, such as \cite{2017arXiv170902939M} does, for a worldwide classification of road networks. Such an approach avoids the question of isolating relevant features.
However, as we aim at calibrating generative models, our quantification will make more sense with interpretable measures.
%devrait on justifier pourquoi on a besoin de mesures interpr√©tables ???
%. je pense, en reaction a la tendance deep learning etc ? (mais c'est peut etre pas pertinent en effet)
\cite{boeing2018measuring} proposes an extensive review of existing measures from a large extent of disciplines, their implications for planning and design, and the relation with urban complexity. \cite{webster1995urban} uses image processing techniques such as contrast or Fourier analysis, to extract synthetic descriptions of urban areas from satellite imaging. \cite{fumega2014identification} provide a typology of cities in relation with energy consumption in the perspective of climate change. \cite{rode2014cities} relate indicators of urban form with residential heat-energy demand. Other complexity-related approaches such as fractal dimensions have been introduced as for example by \cite{batty1987fractal}.



In practice, we use a variety of indicators capturing different aspects, each being detailed below. We consider the local urban space as a square grid of width $\sqrt{N}$ with cells $1 \leq i \leq N$, and an urban configuration is a binary function $s_i \in \{0;1\}$ on these cells. For the computation of indicators, we consider underlying complementary networks, the building network $B$ defined as nodes in centroids of occupied cells and links between two occupied direct neighbor cells (one cell unit of distance between centroids), and the free space network $\bar{B}$ defined similarly on empty cells. This raster representation is convenient as compatible with the various types of indicators and generators as described below. We will consider $\sqrt{N}=50$ in the following, and real windows of width $500m$.
%  justify the raster configuration (wouldnt be more logical to have vector generators at this scale ? discuss on "patches" : we do not care about even smaller details in buildings (as architects could do), but on the spatial distribution of free/occupied space at the granularity of patches. consistent with morpho indicators as they are computed, specifically for morpho math.

\subsubsection{Basic indicators}
% building area, density, moran, average distance, number of buildings (components), average building area
Simple descriptive indicators considered are (i) the total building density $A = \frac{1}{N}\cdot \sum_i s_i$; (ii) the number of buildings given by the number of connected components of $B$; (iii) the average building area, i.e. the average size of $B$ connected components; (iv) Moran index capturing spatial autocorrelation (see \cite{raimbault2018calibration} for its definition in a similar setting), with a simple inverse distance weight function; (v) average distance between non-empty points (which also captures a level of concentration).


\subsubsection{Network indicators}
% avg detour, average component area

We also use indicators computed with the underlying networks: the average detour computed in the free space network $\bar{B}$, computed by randomly sampling 50 pairs of points in a connected component of $\bar{B}$ and computing the ratio between the network distance and the euclidian distance $d_{\bar{B}}/d_E$. This measures captures in a way the sinuosity of streets from a mobility viewpoint. We also consider the average size of open connected areas as the average size of the connected components of $\bar{B}$.


\subsubsection{Mathematical morphology indicators}
% dilation steps, erosion steps
% closing / opening not included - would require profile = f(kernel size)

Finally, indicators inspired from the field of mathematical morphology \citep{serra1983image} have already been applied to the quantification of urban form as for example by \cite{pesaresi2003recognizing}. Mostly used in image processing, these techniques proceed to the convolution of the image with a filter for example to simplify some morphological detail, what can be interpreted as a kind of spatial smoothing. We use here an indicator based on erosion with a filter of smallest size, which here removes points which 4 closest neighbors are not also occupied. We consider the total number of steps to fully erode the image, which is linked to building size. Similarly, using the operation of dilation, which in the contrary occupies points with at least one occupied neighbor, we consider the total number of dilation steps to fully fill the grid. This captures the size of open spaces. We do not consider indicators linked to opening and closing operations, as these would require more complex filters and for example their behavior as a function of kernel size.


Combining these morphological indicators, we have a total number of 9 indicators that can be computed on any binary grid, and that we will use in the following to compare real grids with generated grids of the same size.





%\subsection{Real urban morphologies}
% osm buildings
% not needed as procedure for osm data is explained in results



\subsection{Generative models}

We detail now the generative model introduced. A null model is also considered, to ensure the relevance of the morphological measures and the adjustments on these. It consists in a random grid generator, where each cell is occupied if a random uniform number between 0 and 1 is below a density parameter $d_R$.

%%%%%%%%%%%%%%
\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{fig1.png}
    \caption{Examples of patterns produced by the synthetic generators.}
    % TODO should provide parameters here
    \label{fig:generators}
\end{figure}
%%%%%%%%%%%%%%



\subsubsection{Blocks generator}

% bon, pour moi les deux premiers mod√®les sont des mod√®les proc√©duraux et pourraient √™tres formalis√©s comme des mpp mais je ne sais pas si c'est pertinent de redire √ßa √† chaque fois...
% -> d'accord avec toi !
The most simple ``realistic'' generator is similar to procedural modeling or marked point processes and distributes building blocks into the space (see Fig.~\ref{fig:blocks}). Given a number $N_B$ of blocks, random positions are drawn and block of a random height and width (with minimal value $m_B$ and maximal value $M_B$ as parameters) are placed at these.


\subsubsection{Kernel mixture generator}

Kernel mixture are a classical way to represent the spatial distribution of population density in an urban area \citep{anas1998urban} (see Fig.~\ref{fig:mixture}). They remain relevant at our scale, as they can be interpreted as a superposition of ``density hotspots'', as can the planning or the self-organization of a district can be. Given a number of centers $N_K$, $\vec{x}_{1\leq j \leq N_K}$ random position are drawn in the grid, at which kernels are applied, such that $s_i = \mathbbm{1}_{d_i \geq \theta_K}$ where the density $d_i$ for the point at position $\vec{y}_i$ is given by
\begin{equation}
    d_i = \frac{1}{N_K}\cdot \sum_j \exp{\left(-\norm{\vec{x}_j - \vec{y}_i}/d_K\right)} 
\end{equation}
where $d_K$ is a range parameter giving the extent of kernels.
% je ne suis pas convaincu par la formule : il y a un truc que j'ai rat√© ou il manque un vecteur
% si les x_i correspondent aux posistion des centres (hotspots), alors on ne calcule les densit√©s que sur les hotspots et il nous manque la possibilit√© de calculer les densit√©s pour les autres points. On aurait pas besoin de 2 vecteurs ? x_i => les centres, y_i => l'ensemble des points ?
% Dans le papier d'Anas il triche un peu : il utilise x_ij (mn dans le papier) pour la distance entre le point i et le centre j...
%. -> oui c'est ca, cetait pas les memes xi en effet cetait la coordone du point ou calcul√© ; renomme en yi comme tu suggerais

\subsubsection{Network percolation model}

The last generator we used is based on network percolation, in the spirit of capturing the constraints imposed by flows traversing a given urban area (see Fig.~\ref{fig:percolation}). While the two previous generator were based on building processes, this one relies on streets, and thus on processes linked to transportation. The idea is to link a fixed number $N_P$ of border points, which can be understood as entrances/exits of the area. Starting with a grid network without links and nodes at a regular spatial sampling (fixed with a step of 5 units in our case), an iterative procedure (i) draws a random number and adds a random link at an empty potential link if it is smaller than a parameter called the percolation probability $p_P$; (ii) computes the largest connected component of the network and the number of nodes of this component on the boundary of the world; (iii) stops if this number is equal to the parameter $N_P$. Cells not covered by the resulting giant component are then occupied, at the exception of cells within a neighborhood $L_P$ of a link of the giant component. This way, this component can be understood as a circulating area linking $N_P$ entrances and exits, with a constraint on width through $L_P$.


Note that our generators will be ``fairly compared'' in terms of calibration, as they have the same number of parameters (although we do not introduce any information criteria that would yield the same penalization for overfitting).
We show in Fig.~\ref{fig:generators} visual representations of some outputs of each generator, including a random generator (see Fig.~\ref{fig:random}).


%%%%%%%%%%%%%%%%%%%%%
\section{Results} \label{sec:results}

Simulation results and real measures are available on the dataverse repository at \url{https://doi.org/10.7910/DVN/LGK0US}. Source code is available on the git repository of the project at \url{https://github.com/openmole/spatialdata}.
% TODO split repositories
The model and indicators were coded in scala langage for performance purposes. This furthermore allows a seamless integration into the OpenMOLE workflow engine for model exploration \citep{reuillon2013openmole}, which provides methods for numerical experiments (in our case sampling methods) and transparent access to high performance computation environments (model simulation were run on the European Grid Infrastructure for an equivalent of one year and one month CPU time).



%%%%%%%%%%%%%%
\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{fig2.png}
        \caption{Samples extracted from OpenStreetMap.}
    % provide coordinates ?
    \label{fig:osm}
\end{figure}
%%%%%%%%%%%%%%

%%%%%%%%%%%
\subsection{Real measures}



%%%%%%%%%%%%%%
\begin{figure*}
\vspace{-1cm}
  \centering
  \includegraphics[width=0.57\linewidth]{fig3}
    \caption{Typology applied to OpenStreetMap samples. The first class correspond mostly to a high density of linear buildings, recalling modern urbanism projects; the second disparate large buildings that can corresponds to industrials buildings in the outskirt of cities; the third disparate small buildings closer to periurban settlements; the fourth are denser and more complicated patterns evoking historical urban centers.}
  % provide coordinates ?
  \label{fig:osm_types}
\end{figure*}
%%%%%%%%%%%%%%




We compute the morphological indicators given above on a large sample on real urban areas. For practical computational reasons, we restrain our geographical area of study to European functional urban areas as provided by \cite{bretagnolle2019following}. We expect to already have a good representativity, although not universal, of existing urban forms with this sample, as it is known that European cities already have a significant morphological diversity \citep{le2015forme}. We collect building layouts from OpenStreetMap (illustrated in Figure~\ref{fig:osm}), as this source has been shown to have a good quality especially in Europe \citep{mooney2010towards}. Using the \texttt{osmosis} tool, buildings are filtered from the openstreetmap raw dump for Europe (downloaded from \url{http://download.geofabrik.de/} in March 2019) and inserted into a Postgis database, which can then be efficiently queried for a specific bounding box. Indeed, although the library developed provides a direct access to the OpenStreetMap API, query limitations do not allow such a systematic sampling.
%Our tool also provide a direct access to the classic and overpass API % not necessary ?
We sample $N=72,000$ points into polygons corresponding to urban areas, first by selecting the area with a uniform selection weighted by population of areas, then by drawing uniform spatial coordinates within the polygon with a polygon sampling heuristic. % TODO clarify the polygon sampler

%  dim(real)
% 17612    16
%                           PC1    PC2     PC3
% Cumulative Proportion  0.7031 0.8592 0.92755


After removing the empty areas and areas with a too low (lower than 0.05) or a too high (higher than 0.8) density, we end with $17,612$ real points on which the morphological measures are computed. The effective dimension is relatively low, echoing literature on urban form at other scales, as the first principal component on normalized indicators captures 70.3\% of variance, the second a cumulated proportion of 85.9\% and the third 92.8\%. The order of magnitude are similar to the ones found by \cite{Schwarz201029} for example. The first component captures low density (coefficient -0.43 for density) but clustered configurations (-0.35 for average distance), confirmed by the positive influence of dilation steps (0.44). On the contrary, the second component captures dispersed configurations (negative Moran and positive average distance) with large blocks (negative dilation steps).

%                           PC1         PC2
%moran              0.01962239 -0.29010345
%avgDistance       -0.35342592  0.43463871
%density           -0.43963530 -0.35137034
%components        -0.45898251  0.02350718
%avgDetour         -0.24658880 -0.60285531
%avgBlockArea       0.01057885 -0.24560142
%avgComponentArea   0.46349104 -0.06682787
%fullDilationSteps  0.44023730 -0.25226912
%fullErosionSteps  -0.03478745 -0.33324949





%     moran          avgDistance        density         components      avgDetour        avgBlockArea  
% Min.   :0.01881   Min.   :0.2120   Min.   :0.0504   Min.   :  7.0   Min.   : 0.1165   Min.   :  4.0  
% 1st Qu.:0.07658   1st Qu.:0.6630   1st Qu.:0.0984   1st Qu.: 60.0   1st Qu.: 4.6543   1st Qu.: 10.0  
% Median :0.10421   Median :0.8022   Median :0.1860   Median :109.0   Median : 6.9233   Median : 12.0  
% Mean   :0.11659   Mean   :0.7586   Mean   :0.2193   Mean   :126.9   Mean   : 7.7544   Mean   : 14.8  
 %3rd Qu.:0.14063   3rd Qu.:0.8870   3rd Qu.:0.3120   3rd Qu.:184.0   3rd Qu.:10.1821   3rd Qu.: 16.0  
% Max.   :0.93934   Max.   :1.1405   Max.   :0.7980   Max.   :413.0   Max.   :26.3172   Max.   :143.0  
% avgComponentArea fullDilationSteps fullErosionSteps
% Min.   :  5.00   Min.   : 3        Min.   : 1.000  
% 1st Qu.: 30.00   1st Qu.:16        1st Qu.: 3.000  
% Median : 54.00   Median :26        Median : 4.000  
% Mean   : 60.32   Mean   :28        Mean   : 4.049  
% 3rd Qu.: 86.00   3rd Qu.:38        3rd Qu.: 5.000  
% Max.   :183.00   Max.   :80        Max.   :21.000  


We obtain a broad variety of forms, measures such as the Moran index varying between 0.02 (small disparate settlements) to 0.93 (one huge block), with a median at 0.10 (several medium size buildings). Similarly, the number of dilation steps varies from 3 (narrow streets only) to 80 (mostly open spaces) with a median at 26. The mean density is 0.21, what means that around 21\% of the soil is covered with building in average in the space we sampled, confirming that the most of urban areas are not dense contrary to the highly dense centers which are a minority.


To obtain typical representative points, we proceed to an unsupervised clustering on the two first principal components of these points. Using a k-means algorithm (5000 stochastic repetitions), varying the number of clusters shows an endogenous transition in the within-cluster variance proportion, suggesting to take $k=4$. Examples within the classes are shown and commented in Fig.~\ref{fig:osm_types}. The centroids will be used as typical objectives for model calibration.



% figure not needed : existence of clear distinctions (diversity index) and correlation with coordinates is enough
%%%%%%%%%%%%%%
%\begin{figure}
%    \centering
%    \includegraphics{}
%    \caption{Typology of morphological profiles of European urban areas.}
%    \label{fig:realtypology}
%\end{figure}
%%%%%%%%%%%%%%


%%%%%%%%%%%%%%
\begin{figure*}
\vspace{-1.8cm}
    \centering
    \includegraphics[width=\linewidth]{fig4}
    \caption{Comparison of real morphologies with patterns produced by the synthetic generators. All points are projected into the first two components computed on the real measures only. Points in dark blue correspond to real configurations. The type of generator is given by the color in legend. Dark circle correspond to the centroids of clusters on which the calibration is done, their number giving the corresponding configurations shown above. For each, we successively show the best synthetic configuration ((1) block generator with $N_B=12,m_B=5,M_B=12$, (2) exponential mixture generator with $N_K=6,d_K=3.8,\theta_K=0.42$, (3) block generator with $N_B=11,m_B=1,M_B=14$, (4) percolation generator with $p_P=0.35,N_P=5,L_P=3.7$), and the real configuration from OSM beside each.}
    \label{fig:lhs}
\end{figure*}
%%%%%%%%%%%%%%


We can also consider the distribution of these measures within sampled urban areas. Keeping the areas with more than 10 sample points, we obtain 219 areas, for which we can compute the proportion of points within each morphological cluster. An Herfindhal diversity index on these proportions $p_k \in \left[0,1\right]$ computed as $h = 1 - \sum_k p_k^2$ ranges between 0.31 and 0.75 with an average of 0.63, suggesting very different profiles of urban areas. A chi-squared test of 10 levels of this diversity with the country is not significant (p=0.7), but the diversity index negatively correlates ($\rho = -0.11$, Fisher 95\% confidence interval $\left[-0.24,0.02\right]$) with longitude, meaning that Western cities are more diverse than Eastern cities, and more slightly with latitude ($\rho = 0.08 \left[-0.04,0.21\right]$).




%%%%%%%%%%%
\subsection{Model simulation and calibration}



A simulation experiment provides an insight into the patterns produced by the different generators in the morphological space. We sample the parameter space using a Latin Hypercube Sampling, with 10000 points for each generator respectively, and with 100 stochastic repetitions for each parameter point. This sampling is achieved with scripting the models into the OpenMOLE platform~\citep{reuillon2013openmole}.

Regarding the stochastic variability of generators, we compute for each indicator and each parameter point the sharpe ratios on repetitions, defined as the ratio between the estimated average and the estimated standard deviation. The indicators with the lowest values (high values indicate a low influence of stochastic fluctuations in comparison to variations due to parameters) are Moran index with a minimum of 0.22 and a median of 4.8, and the average detour with a minimum of 0.7 and a median of 5.2 (what could have been expected for this one as it is stochastically estimated). All other indicators have minimal sharpe ratios above 1.5 and medians above 5.4, meaning that models are overall not much sensitive to stochastic fluctuations. This confirms that considering single realisations as representing one parameter set remains reasonable.





We turn now to the comparison of generated configurations with real configurations. We work in the projected two dimensional space of the two first principal components of real points described above, in order to capture the maximum of variability in the real point cloud rather than in the simulated one. Note that working in the full indicator space makes no sense given the effective dimensions obtained (the simulated point cloud captures 93\% of variance at its third principal component, which is just a bit more than the real point cloud).


The point cloud of simulated and real points is shown in Fig.~\ref{fig:lhs}. We do not plot ensemble averages but all simulated points, as discussed above regarding the low influence of stochasticity. First of all, we observe that the null model consisting in random grids is far from all other points (except a tiny fraction of the percolation generator in turquoise) and in a way describes a boundary in the projected indicator space. This control confirms the relevance of projected indicators and of their comparison. 
Then, as expected since generators were conceived to capture different generative processes of the urban form, the point clouds of each generator are rather disjoint in the morphological space. The percolation generator produces separate clouds which correspond to different value of the link width $L_P$ parameter, and these are disjoint from the two other generators. The exponential mixture (green) and block (red) generators do overlap in a central area, but also have their own morphological ``exclusion zone'', where the forms can not be generated by other generators considered here.

When looking at the real point cloud, we see that most of it is covered by some generated points, and that generators are complementary to approach all covered points. This is an important result in line with the targeted complementarity of generative processes, and advocates for multi-modeling in urban morphogenesis. Interestingly, there is an area not covered, corresponding to the transition between the percolation generator (narrow streets) and the block generator.

For each centroid of the clusters in the real point cloud described above, that can be considered as a typical calibration objective, we provide example of the closest real configuration and the closest simulated one. Visually, forms are rather satisfying, at the exception of the percolation generator fitting a complicated urban center. Indeed, this centroid (number 4) is at the boundary of the percolation point cloud, and the real point cloud is more difficultly captured in this area compared to the block and mixture generators.


% les calibrations sont ULTRA mediocres, j'arrive pas a savoir pourquoi - pourtant ya beaucoup de runs - peut etre les islands trop courtes. on va surement devoir s'en resumer a un tableau de la distance de chaque generateur a chaque centroide ; avec l'info de plus de l'aggregation eventuellement - avec la sd.
%%%%%%%%%%%
%\subsection{Calibration with Genetic algorithms}
%The mapping between generator parameters and the morphological space being highly non-linear, we are not ensured that the proximities observed above fully correspond to the potentialities of generators to generate real forms. Therefore, we proceed here to a calibration of these models.

%%%%%%%%%%%%%%%%%
\begin{table*}[h]
\center{
\begin{tabular}{|c|c|c|c|c|}\hline
           & Random & Blocks & Exp. Mixture & Percolation\\ \hline\hline
Centroid 1 & $0.424 \pm 0.011$ & $0.106 \pm 0.063$ & $0.303\pm 0.101$ & $0.325\pm 0.019$ \\
Centroid 2 &$0.809\pm 0.022$&$0.164\pm 0.099$&$0.184\pm 0.141$&$0.947\pm 0.019$\\
Centroid 3 &$0.428\pm 0.019$&$0.095\pm 0.054$&$0.109\pm 0.064$&$0.541\pm 0.019$\\
Centroid 4 &$0.515 \pm 0.005$&$0.311\pm 0.077$&$0.589\pm 0.149$ &$0.083\pm 0.025$\\\hline
\end{tabular}
}
\vskip 0.25cm
\caption{Aggregated distance in the morphological space, for each generator and each calibration objective (real clusters centroids). Euclidian distance in the projected space are aggregated in average on stochastic repetitions, and the minimal average value is reported with its standard deviation.\label{tab:averagedists}}
\end{table*}
%%%%%%%%%%%%%%%%%


To quantify the level of calibration of each generator regarding each centroid, and in average regarding stochastic repetitions, we provide in Table~\ref{tab:averagedists} the aggregated minimal values of distances, for each generator and each calibration objective, with their standard deviations. This mainly confirms the previous results, with however interesting variations: (i) for the second centroid, the exponential mixture is in average no longer the best, and furthermore has a higher variability; (ii) centroid three and four are the easiest to reach, despite the latest being in the boundary; (iii) the percolation generator performs well on this point and has a very low variability.


This experiment has therefore shown the possibility to calibrate the generative models on morphological measures against real configurations, and furthermore unveils their complementarity to approach the diverse existing forms.









%%%%%%%%%%%%%%%%%%%%%
\section{Discussion} \label{sec:discussion}

% TODO if no credible calib results -> discuss how it could be done. Rq : the calibration in high dimension with a projection is tricky / not much studied -- cf similar issue with diversity algorithms and the proposal of a PSE-PCA.

Our approach provides a first step towards systematic modeling of generative processes of urban form at large scales. Some direct limitations could be tackled in a short term. Testing slightly different processes and heuristics in generator may be a way to cover the part of the real point cloud which is missed by our generators. As it seems correspond to complicated urban centers, it may be however complicated without more elaborated models. Also, we did not use minimization algorithms to calibrate the generators, and the and a further step would consist in checking the robustness of our result using such optimization heuristics (genetic algorithms for example), but also diversity algorithms such as pattern space exploration proposed by \cite{10.1371/journal.pone.0138212}, to ensure the effective feasible space of each generator. 


This work can also be extended in several ways. First of all, we focused on the built environment but neglected transportation infrastructures, whereas spatial network morphogenesis models have been proposed for example by \cite{courtat2011mathematics} or \cite{raimbault2018multi} in a multi-modeling approach.
Taking into account multiple dimensions of the urban system is an important extension and hybrid models such as co-evolution models \citep{raimbault2014hybrid} should be investigated.

Furthermore, we tested the complementarity of generators only in a static way. Adaptive and dynamic generators, combining processes of different nature within the same model with an endogenous switching or combination, would be an important direction to better understand urban morphogenesis.
In the same context, the generators compared here had all the same number of parameters, but richer generators implying different numbers would require the use of information criterions to avoid overfitting, which, however, remains an unsolved issue for such generative simulation models \citep{piou2009proposing}.

Finally, as extensively reviewed above, the way to quantify urban form strongly depends on the scale considered. A more integrative understanding of it would require multi-scale approaches able to relate these different definition and measures within a single multi-scalar framework.


%%%%%%%%%%%%%%%%%%%%%
\section{Conclusion}

We have proposed here a new insight into the generative simulation of urban morphologies at large scales, namely the scale of the district considering the layout of buildings. After computing morphological measures on a large sample of real urban areas, we showed the complementarity of different generators capturing various aspects of urban morphogenesis processes. Despite not implying generative agents (developers, inhabitants, companies) and thus staying close to procedural modeling, this work however paves the way towards a more systematic understanding of generative processes of urban form at this scale.



%%%%%%%%%%%%%%%%%%%%%
\section{Acknowledgements}

Results obtained in this paper were computed on the vo.complex-system.eu virtual organization of the European Grid Infrastructure ( http://www.egi.eu ). We thank the European Grid Infrastructure and its supporting National Grid Initiatives (France-Grilles in particular) for providing the technical support and infrastructure.

\footnotesize
\begin{thebibliography}{}

\bibitem[Achibet et~al., 2014]{achibet2014model}
Achibet, M., Balev, S., Dutot, A., and Olivier, D. (2014).
\newblock A model of road network and buildings extension co-evolution.
\newblock {\em Procedia Computer Science}, 32:828--833.

\bibitem[Anas et~al., 1998]{anas1998urban}
Anas, A., Arnott, R., and Small, K.~A. (1998).
\newblock Urban spatial structure.
\newblock {\em Journal of economic literature}, 36(3):1426--1464.

\bibitem[Batty and Longley, 1987]{batty1987fractal}
Batty, M. and Longley, P.~A. (1987).
\newblock Fractal-based description of urban form.
\newblock {\em Environment and planning B: Planning and Design},
  14(2):123--134.

\bibitem[Boeing, 2018]{boeing2018measuring}
Boeing, G. (2018).
\newblock Measuring the complexity of urban form and design.
\newblock {\em URBAN DESIGN International}, 23(4):281--292.

\bibitem[Bonabeau, 1997]{bonabeau1997classical}
Bonabeau, E. (1997).
\newblock From classical models of morphogenesis to agent-based models of
  pattern formation.
\newblock {\em Artificial life}, 3(3):191--211.

\bibitem[Bretagnolle et~al., 2019]{bretagnolle2019following}
Bretagnolle, A., Guerois, M., and Pavard, A. (2019).
\newblock Following the population of european urban areas in the last half
  century (1961-2011): the tradeve database.
\newblock {\em Forthcoming in Cybergeo, European Journal of Geography}.

\bibitem[Ch{\'e}rel et~al., 2015]{10.1371/journal.pone.0138212}
Ch{\'e}rel, G., Cottineau, C., and Reuillon, R. (2015).
\newblock Beyond corroboration: Strengthening model validation by looking for
  unexpected patterns.
\newblock {\em PLoS ONE}, 10(9):e0138212.

\bibitem[Courtat et~al., 2011]{courtat2011mathematics}
Courtat, T., Gloaguen, C., and Douady, S. (2011).
\newblock Mathematics and morphogenesis of cities: A geometrical approach.
\newblock {\em Physical Review E}, 83(3):036106.

\bibitem[Cruz et~al., 2017]{cruz2017generation}
Cruz, C., Kirley, M., and Karakiewicz, J. (2017).
\newblock Generation and exploration of architectural form using a composite
  cellular automata.
\newblock In {\em Australasian Conference on Artificial Life and Computational
  Intelligence}, pages 99--110. Springer.

\bibitem[Epstein, 1999]{epstein1999agent}
Epstein, J.~M. (1999).
\newblock Agent-based computational models and generative social science.
\newblock {\em Complexity}, 4(5):41--60.

\bibitem[Fumega et~al., 2014]{fumega2014identification}
Fumega, J., Niza, S., and Ferr{\~a}o, P. (2014).
\newblock Identification of urban typologies through the use of urban form
  metrics for urban energy and climate change analysis.

\bibitem[Gauthier and Gilliland, 2006]{gauthier2006mapping}
Gauthier, P. and Gilliland, J. (2006).
\newblock Mapping urban morphology: a classification scheme for interpreting
  contributions to the study of urban form.
\newblock {\em Urban Morphology}, 10(1):41.

\bibitem[Herold et~al., 2003]{herold2003spatiotemporal}
Herold, M., Goldstein, N.~C., and Clarke, K.~C. (2003).
\newblock The spatiotemporal form of urban growth: measurement, analysis and
  modeling.
\newblock {\em Remote sensing of Environment}, 86(3):286--302.

\bibitem[Horner, 2007]{horner2007multi}
Horner, M.~W. (2007).
\newblock A multi-scale analysis of urban form and commuting change in a small
  metropolitan area (1990--2000).
\newblock {\em The Annals of Regional Science}, 41(2):315--332.

\bibitem[Kropf, 2009]{kropf2009aspects}
Kropf, K. (2009).
\newblock Aspects of urban form.
\newblock {\em Urban Morphology}, 13(2):105.

\bibitem[Le~N{\'e}chet, 2015]{le2015forme}
Le~N{\'e}chet, F. (2015).
\newblock De la forme urbaine {\`a} la structure m{\'e}tropolitaine: une
  typologie de la configuration interne des densit{\'e}s pour les principales
  m{\'e}tropoles europ{\'e}ennes de l‚Äôaudit urbain.
\newblock {\em Cybergeo: European Journal of Geography}.

\bibitem[Liu et~al., 2017]{liu2017future}
Liu, X., Liang, X., Li, X., Xu, X., Ou, J., Chen, Y., Li, S., Wang, S., and
  Pei, F. (2017).
\newblock A future land use simulation model (flus) for simulating multiple
  land use scenarios by coupling human and natural effects.
\newblock {\em Landscape and Urban Planning}, 168:94--116.

\bibitem[Merrell et~al., 2010]{merrell2010computer}
Merrell, P., Schkufza, E., and Koltun, V. (2010).
\newblock Computer-generated residential building layouts.
\newblock In {\em ACM Transactions on Graphics (TOG)}, volume~29, page 181.
  ACM.

\bibitem[Mooney et~al., 2010]{mooney2010towards}
Mooney, P., Corcoran, P., and Winstanley, A.~C. (2010).
\newblock Towards quality metrics for openstreetmap.
\newblock In {\em Proceedings of the 18th SIGSPATIAL international conference
  on advances in geographic information systems}, pages 514--517. ACM.

\bibitem[{Moosavi}, 2017]{2017arXiv170902939M}
{Moosavi}, V. (2017).
\newblock {Urban morphology meets deep learning: Exploring urban forms in one
  million cities, town and villages across the planet}.
\newblock {\em arXiv e-prints}, page arXiv:1709.02939.

\bibitem[Moudon, 1997]{moudon1997urban}
Moudon, A.~V. (1997).
\newblock Urban morphology as an emerging interdisciplinary field.
\newblock {\em Urban morphology}, 1(1):3--10.

\bibitem[Newman and Kenworthy, 2000]{newman2000sustainable}
Newman, P. and Kenworthy, J. (2000).
\newblock Sustainable urban form: the big picture.
\newblock {\em Achieving sustainable urban form}, pages 109--120.

\bibitem[Parish and M\"{u}ller, 2001]{Parish:2001:PMC:383259.383292}
Parish, Y. I.~H. and M\"{u}ller, P. (2001).
\newblock Procedural modeling of cities.
\newblock In {\em Proceedings of the 28th Annual Conference on Computer
  Graphics and Interactive Techniques}, SIGGRAPH '01, pages 301--308, New York,
  NY, USA. ACM.

\bibitem[Pesaresi and Bianchin, 2003]{pesaresi2003recognizing}
Pesaresi, M. and Bianchin, A. (2003).
\newblock Recognizing settlement structure using mathematical morphology and
  image texture.
\newblock {\em Remote sensing and urban analysis: GISDATA}, 9:46--60.

\bibitem[Piou et~al., 2009]{piou2009proposing}
Piou, C., Berger, U., and Grimm, V. (2009).
\newblock Proposing an information criterion for individual-based models
  developed in a pattern-oriented modelling framework.
\newblock {\em Ecological Modelling}, 220(17):1957--1967.

\bibitem[Raimbault, 2018a]{raimbault2018calibration}
Raimbault, J. (2018a).
\newblock Calibration of a density-based model of urban morphogenesis.
\newblock {\em PloS one}, 13(9):e0203516.

\bibitem[Raimbault, 2018b]{raimbault2018multi}
Raimbault, J. (2018b).
\newblock Multi-modeling the morphogenesis of transportation networks.
\newblock In {\em Artificial Life Conference Proceedings}, pages 382--383. MIT
  Press.

\bibitem[Raimbault, 2018c]{raimbault2018urban}
Raimbault, J. (2018c).
\newblock An urban morphogenesis model capturing interactions between networks
  and territories.
\newblock In {\em Mathematics of Urban Morphogenesis, D'Acci L., ed. Springer
  Birkhauser Mathematics.}

\bibitem[Raimbault et~al., 2014]{raimbault2014hybrid}
Raimbault, J., Banos, A., and Doursat, R. (2014).
\newblock A hybrid network/grid model of urban morphogenesis and optimization.
\newblock In {\em 4th International Conference on Complex Systems and
  Applications}, pages 51--60.

\bibitem[Reuillon et~al., 2013]{reuillon2013openmole}
Reuillon, R., Leclaire, M., and Rey-Coyrehourcq, S. (2013).
\newblock Openmole, a workflow engine specifically tailored for the distributed
  exploration of simulation models.
\newblock {\em Future Generation Computer Systems}, 29(8):1981--1990.

\bibitem[Rode et~al., 2014]{rode2014cities}
Rode, P., Keim, C., Robazza, G., Viejo, P., and Schofield, J. (2014).
\newblock Cities and energy: urban morphology and residential heat-energy
  demand.
\newblock {\em Environment and Planning B: Planning and Design},
  41(1):138--162.

\bibitem[Schwarz, 2010]{Schwarz201029}
Schwarz, N. (2010).
\newblock Urban form revisited---selecting indicators for characterising
  european cities.
\newblock {\em Landscape and Urban Planning}, 96(1):29 -- 47.

\bibitem[Serra, 1983]{serra1983image}
Serra, J. (1983).
\newblock {\em Image analysis and mathematical morphology}.
\newblock Academic Press, Inc.

\bibitem[Watson et~al., 2008]{watson2008procedural}
Watson, B., M{\"u}ller, P., Veryovka, O., Fuller, A., Wonka, P., and Sexton, C.
  (2008).
\newblock Procedural urban modeling in practice.
\newblock {\em IEEE Computer Graphics and Applications}, 28(3):18--26.

\bibitem[Webster, 1995]{webster1995urban}
Webster, C. (1995).
\newblock Urban morphological fingerprints.
\newblock {\em Environment and Planning B: Planning and design},
  22(3):279--297.

\bibitem[Ye and Van~Nes, 2014]{ye2014quantitative}
Ye, Y. and Van~Nes, A. (2014).
\newblock Quantitative tools in urban morphology: Combining space syntax,
  spacematrix and mixed-use index in a gis framework.
\newblock {\em Urban morphology}, 18(2):97--118.

\end{thebibliography}


\end{document}



%%%%%%%
%% Templates

%\begin{figure}[t] % [!tbp] % [ht]
%\begin{center}
%\includegraphics[width=2.2in, angle=90]{fig5.eps}
%\vskip 0.25cm
%\caption{Fitted exponent of power law for 34 runs at mutation rates  between $R=0.0005$ and $R=0.01$ copy errors per instruction  copied. The error bars reflect the standard deviation across the  sample of runs taken at each mutation rate. The solid line is to  guide the eye only.}
%\label{fig5}
%\end{center}
%\end{figure}


%\begin{table}[h]
%\center{
%\begin{tabular}{|c|c|c|c|}\hline
%Name & Result & Bonus $b_i$ & Difficulty\\ \hline\hline
%Echo & I/O   & 1 & --\\
%Xor  & $ A\ {\rm xor}\ B$ &   6 & 4 \\
%Equals &$\neg(A\ {\rm xor}\ B)$&6& 4 \\ \hline
%\end{tabular}
%}
%\vskip 0.25cm
%\caption{Logical calculations on random inputs $A$ and $B$ rewarded,bonuses, and difficulty (in minimum number of {\tt nand} instructionsrequired). Bonuses $b_i$ increase the speed of a CPU by a factor
%$\nu_i=1+2^{b_i-3}$.}
%\end{table}


